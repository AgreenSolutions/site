<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../css/dash.css" />
  <link rel="icon" href="../assets/imgs/Agreen_-_White_with_Black.png" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/2.0.1/chartjs-plugin-annotation.min.js"
    integrity="sha512-LZEOcU8s74hwWva82MJux7GgFNjfeExXG9yZPQrKz567Od4O2D/6UX3oGoZiRDOdbMtH33NBq7vonH4VOUPA/Q=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="../js/funcoes.js"></script>

  <title>Dashboard</title>
</head>

<body onload="atualizacaoPeriodica()">


  <div class="modal-container">
    <div class="modal">
      <button onclick="closeModal()" class="fechar">X</button>
      <div class="kpi">
        <div class="kpi-1">
          <div class="kpi-title">
            Maior Temperatura nos últimos 7 dias
          </div>
          <div class="kpi-data">
            24.7°C
          </div>
        </div>
        <div class="kpi-1">
          <div class="kpi-title">
            Maior Umidade nos últimos 7 dias
          </div>
          <div class="kpi-data">
            72%
          </div>
        </div>
        <div class="kpi-1">
          <div class="kpi-title">
            Menor Temperatura nos últimos 7 dias
          </div>
          <div class="kpi-data">
            20°C
          </div>
        </div>
        <div class="kpi-1">
          <div class="kpi-title">
            Menor Umidade nos últimos 7 dias
          </div>
          <div class="kpi-data">
            64.4%
          </div>
        </div>
        <div class="kpi-1">
          <div class="kpi-title2">
            Variação Temperatura ultima 1 Hora
          </div>
          <div class="kpi-data">
            1.4°C
          </div>
        </div>
        <div class="kpi-1">
          <div class="kpi-title2">
            Variação Umidade ultima 1 Hora
          </div>
          <div class="kpi-data">
            2%
          </div>
        </div>
      </div>
      <div class="graficos">
        <div class="grafico-1">
          <canvas id="myChart"></canvas>
        </div>
        <div class="grafico-2">
          <canvas id="myChart2"></canvas>
        </div>
      </div>
    </div>
  </div>




  <div class="modal-container2">
    <div class="modal2">
      <button onclick="closeModal2()" class="fechar">X</button>
      <div class="kpi">
        <div class="kpi-1">
          <div class="kpi-title">
            Maior Temperatura nos últimos 7 dias
          </div>
          <div class="kpi-data">
            3.2°C
          </div>
        </div>
        <div class="kpi-1">
          <div class="kpi-title">
            Maior Umidade nos últimos 7 dias
          </div>
          <div class="kpi-data">
            80.3%
          </div>
        </div>
        <div class="kpi-1">
          <div class="kpi-title">
            Menor Temperatura nos últimos 7 dias
          </div>
          <div class="kpi-data">
            1.8°C
          </div>
        </div>
        <div class="kpi-1">
          <div class="kpi-title">
            Menor Umidade nos últimos 7 dias
          </div>
          <div class="kpi-data">
            73.48%
          </div>
        </div>
        <div class="kpi-1">
          <div class="kpi-title">
            Variação Temperatura ultima 1 Hora
          </div>
          <div class="kpi-data">
            0°C
          </div>
        </div>
        <div class="kpi-1">
          <div class="kpi-title">
            Variação Umidade ultima 1 Hora
          </div>
          <div class="kpi-data">
            1.3%
          </div>
        </div>
      </div>
      <div class="graficos2">
        <div class="grafico-3">
          <canvas id="myChart3"></canvas>
        </div>
        <div class="grafico-4">
          <canvas id="myChart4"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-container3">
    <div class="modal3">
      <button onclick="closeModal3()" class="fechar">X</button>
      <div class="kpi">
        <div class="kpi-1">
          <div class="kpi-title">
            Maior Temperatura nos últimos 7 dias
          </div>
          <div class="kpi-data">
            23.8°C
          </div>
        </div>
        <div class="kpi-1">
          <div class="kpi-title">
            Maior Umidade nos últimos 7 dias
          </div>
          <div class="kpi-data">
            78.48%
          </div>
        </div>
        <div class="kpi-1">
          <div class="kpi-title">
            Menor Temperatura nos últimos 7 dias
          </div>
          <div class="kpi-data">
            21.8°C
          </div>
        </div>
        <div class="kpi-1">
          <div class="kpi-title">
            Menor Umidade nos últimos 7 dias
          </div>
          <div class="kpi-data">
            71.5%
          </div>
        </div>
        <div class="kpi-1">
          <div class="kpi-title">
            Variação Temperatura ultima 1 Hora
          </div>
          <div class="kpi-data">
            1°C
          </div>
        </div>
        <div class="kpi-1">
          <div class="kpi-title">
            Variação Umidade ultima 1 Hora
          </div>
          <div class="kpi-data">
            5%
          </div>
        </div>
      </div>
      <div class="graficos">
        <div class="grafico-5">
          <canvas id="myChart5"></canvas>
        </div>
        <div class="grafico-6">
          <canvas id="myChart6"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-container4">
    <div class="modal4">
      <button onclick="closeModal4()" class="fechar">X</button>
      <div class="kpi">
        <div class="kpi-1">
          <div class="kpi-title">
            Maior Temperatura nos últimos 7 dias
          </div>
          <div class="kpi-data">
            2.8°C
          </div>
        </div>
        <div class="kpi-1">
          <div class="kpi-title">
            Maior Umidade nos últimos 7 dias
          </div>
          <div class="kpi-data">
            91.3%
          </div>
        </div>
        <div class="kpi-1">
          <div class="kpi-title">
            Menor Temperatura nos últimos 7 dias
          </div>
          <div class="kpi-data">
            1.8°C
          </div>
        </div>
        <div class="kpi-1">
          <div class="kpi-title">
            Menor Umidade nos últimos 7 dias
          </div>
          <div class="kpi-data">
            79.42%
          </div>
        </div>
        <div class="kpi-1">
          <div class="kpi-title">
            Variação Temperatura ultima 1 Hora
          </div>
          <div class="kpi-data">
            0.4°C
          </div>
        </div>
        <div class="kpi-1">
          <div class="kpi-title">
            Variação Umidade ultima 1 Hora
          </div>
          <div class="kpi-data">
            2%
          </div>
        </div>
      </div>
      <div class="graficos">
        <div class="grafico-7">
          <canvas id="myChart7"></canvas>
        </div>
        <div class="grafico-8">
          <canvas id="myChart8"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- navbar -->

  <div class="container">
    <div class="navbar-vert">
      <navbar class="vert">
        <figure>
          <img src="../assets/imgs/Agreen.png" alt="logo" />
        </figure>
        <p id="p_usuario">Olá Usuario</p>

        <ul>
          <li onclick="limparSessao()"><a style="cursor: pointer;">Sair</a></li>
        </ul>
      </navbar>
    </div>

    <div class="conteudo2">
      <div class="container">
      </div>
    </div>

    <div class="legenda">
      <h1>Tipos de Alertas</h1>

      <div class="alertas">
        <svg height="80" width="60">
          <circle cx="30" cy="22" r="16" stroke="red" stroke-width="0" fill="red" />
        </svg>
        <p>Crítico</p>
      </div>
      <div class="alertas">
        <svg height="80" width="60">
          <circle cx="30" cy="22" r="16" stroke="red" stroke-width="0" fill="orange" />
        </svg>
        <p>Emergência</p>
      </div>
      <div class="alertas">
        <svg height="80" width="60">
          <circle cx="30" cy="22" r="16" stroke="red" stroke-width="0" fill="yellow" />
        </svg>
        <p>Alerta</p>
      </div>
      <div class="alertas">
        <svg height="80" width="60">
          <circle cx="30" cy="22" r="16" stroke="red" stroke-width="0" fill="green" />
        </svg>
        <p>Ideal</p>
      </div>
    </div>
    <div class="header-info">


      <div class="info" id="info1">
        <p class="card-analytics-title">Temperatura</p>
        <div class="data-card1">
          <p>Mínima</p>
          <span>-4&deg;</span>
          <p>Mínima</p>
          <span>19&deg;</span>
        </div>

        <div class="data-card2">
          <p>Máxima</p>
          <span>5&deg;</span>
          <p>Máxima</p>
          <span>27&deg;</span>
          <!-- <p class="card-analytics-title2">Gôndola</p> -->
        </div>
        <div class="footer-legenda">
          <span class="card-analytics-title2">Armazenamento</span><span class="card-analytics-title2">Gôndola</span>
        </div>
      </div>

      <div class="info" id="info2">
        <p class="card-analytics-title">Temperatura</p>
        <div class="data-card1">
          <p>Mínima</p>
          <span>-2&deg;</span>
          <p>Mínima</p>
          <span>20&deg;</span>
        </div>

        <div class="data-card2">
          <p>Máxima</p>
          <span>4&deg;</span>
          <p>Máxima</p>
          <span>26&deg;</span>
        </div>
        <div class="footer-legenda">
          <span class="card-analytics-title2">Armazenamento</span><span class="card-analytics-title2">Gôndola</span>
        </div>
      </div>

      <div class="info" id="info3">
        <p class="card-analytics-title">Temperatura</p>
        <div class="data-card1">
          <p>Mínima</p>
          <span>1.5&deg;</span>
          <p>Mínima</p>
          <span>21&deg;</span>
        </div>

        <div class="data-card2">
          <p>Máxima</p>
          <span>3.5&deg;</span>
          <p>Máxima</p>
          <span>25&deg;</span>
        </div>
        <div class="footer-legenda">
          <span class="card-analytics-title2">Armazenamento</span><span class="card-analytics-title2">Gôndola</span>
        </div>
      </div>

      <div class="info" id="info4">
        <p class="card-analytics-title">Temperatura</p>
        <div class="data-card1">
          <p>Mínima</p>
          <span>2&deg;</span>
          <p>Mínima</p>
          <span>22&deg;</span>
        </div>

        <div class="data-card2">
          <p>Máxima</p>
          <span>3&deg;</span>
          <p>Máxima</p>
          <span>24&deg;</span>
        </div>
        <div class="footer-legenda">
          <span class="card-analytics-title2">Armazenamento</span><span class="card-analytics-title2">Gôndola</span>
        </div>
      </div>

      <div class="header-info">


        <div class="info" id="info1">
          <p class="card-analytics-title">Umidade</p>
          <div class="data-card1">
            <p>Mínima</p>
            <span>87%</span>
            <p>Mínima</p>
            <span>60%</span>
          </div>

          <div class="data-card2">
            <p>Máxima</p>
            <span>95%</span>
            <p>Máxima</p>
            <span>80%</span>
          </div>
          <div class="footer-legenda">
            <span class="card-analytics-title2">Armazenamento</span><span class="card-analytics-title2">Gôndola</span>
          </div>
        </div>
        <div class="info" id="info2">
          <p class="card-analytics-title">Umidade</p>
          <div class="data-card1">
            <p>Mínima</p>
            <span>88%</span>
            <p>Mínima</p>
            <span>61%</span>
          </div>

          <div class="data-card2">
            <p>Máxima</p>
            <span>94%</span>
            <p>Máxima</p>
            <span>79%</span>
          </div>
          <div class="footer-legenda">
            <span class="card-analytics-title2">Armazenamento</span><span class="card-analytics-title2">Gôndola</span>
          </div>
        </div>

        <div class="info" id="info3">
          <p class="card-analytics-title">Umidade</p>
          <div class="data-card1">
            <p>Mínima</p>
            <span>89%</span>
            <p>Mínima</p>
            <span>62%</span>
          </div>

          <div class="data-card2">
            <p>Máxima</p>
            <span>93%</span>
            <p>Máxima</p>
            <span>78%</span>
          </div>
          <div class="footer-legenda">
            <span class="card-analytics-title2">Armazenamento</span><span class="card-analytics-title2">Gôndola</span>
          </div>
        </div>

        <div class="info" id="info4">
          <p class="card-analytics-title">Umidade</p>
          <div class="data-card1">
            <p>Mínima</p>
            <span>90%</span>
            <p>Mínima</p>
            <span>65%</span>
          </div>

          <div class="data-card2">
            <p>Máxima</p>
            <span>92%</span>
            <p>Máxima</p>
            <span>75%</span>
          </div>
          <div class="footer-legenda">
            <span class="card-analytics-title2">Armazenamento</span><span class="card-analytics-title2">Gôndola</span>
          </div>
        </div>
      </div>
    </div>


    <div class="cards">

      <div class="card">

        <p class="card-title">Gôndola 1</p>

        <span class="card-span" id="temp">Ultima captura (temperatura): 24.7&deg;</span>
        <span class="card-span" id="umi">Ultima captura (umidade): 72%</span>
        <span class="card-span" id="var">Variação de temperatura: 1.4&deg;</span>



        <button class="btn-card" onclick="openModal()">Ver Gráficos</button>

        <svg height="80" width="60" class="svg">
          <circle id="cir" cx="40" cy="18" r="16" stroke="black" stroke-width="0" fill="green" />
        </svg>
      </div>


      <div class="card">
        <p class="card-title">Freezer 1</p>

        <span class="card-span" id="temp2">Ultima captura (temperatura): 5&deg;</span>
        <span class="card-span" id="umi2">Ultima captura (umidade): 60%</span>
        <span class="card-span" id="var2">Variação de temperatura: 0&deg;</span>



        <button class="btn-card" onclick="openModal2()">Ver Gráficos</button>

        <svg height="80" width="60">
          <circle id="cir2" cx="40" cy="18" r="16" stroke="black" stroke-width="0" />
        </svg>
      </div>







      <div class="card">
        <p class="card-title">Gôndola 2</p>

        <span class="card-span" id="temp3">Ultima captura (temperatura): 20&deg;</span>
        <span class="card-span" id="umi3">Ultima captura (umidade): 78%</span>
        <span class="card-span" id="var3">Variação de temperatura: 1&deg;</span>



        <button class="btn-card" onclick="openModal3()">Ver Gráficos</button>

        <svg height="80" width="60">
          <circle id="cir3" cx="40" cy="18" r="16" stroke="black" stroke-width="0" fill="yellow" />
        </svg>

      </div>





      <div class="card">
        <div class="modal-container">
          <div class="modal">
            <h2>Info</h2>
            <hr />
            <div class="grafico-1">
              <canvas id="myChart"></canvas>
            </div>
            <hr />
            <div class="btns">
              <button class="btnClose" onclick="closeModal()">Fechar</button>
            </div>
          </div>
        </div>

        <p class="card-title">Freezer 2</p>

        <span class="card-span" id="temp4">Ultima captura (temperatura): 2.5&deg;</span>
        <span class="card-span" id="umi4">Ultima captura (umidade): 90%</span>
        <span class="card-span" id="var4">Variação de temperatura: 0,4&deg;</span>



        <button class="btn-card" onclick="openModal4()">Ver Gráficos</button>

        <svg height="80" width="60">
          <circle id="cir4" cx="40" cy="18" r="16" stroke="black" stroke-width="0" fill="green" />
        </svg>
      </div>
    </div>

    <div class="container-help">
      <div class="msg-help">
        <b>Precisa de ajuda ou houve algum problema?</b>
      </div>

      <div class="help">
        <li><a target="_blank" href="https://app.pipefy.com/public/form/aAFJcWw8">Suporte</a></li>
      </div>
    </div>

    <div class="footer">
      <div>
        <h4>Desenvolvido pela Agreen Solution &copy; 2022</h4>
      </div>
    </div>
  </div>


  <!-- grafico -->
  <!-- <div class="grafico-1">
    <canvas id="myChart"></canvas>
  </div> -->
</body>

</html>

<script>

  // function atualizacaoPeriodica() {
  //         obterdados(1);
  //         obterdados(2);
  //         obterdados(3);

  //         function sendData() {
  //       var http = new XMLHttpRequest();
  //       http.open('POST', 'http://localhost:3000/api/sendData', false);
  //       http.send(null);
  //     }

  //         setInterval(() => {
  //       sendData();
  //     }, 2000);
  //         setTimeout(atualizacaoPeriodica, 5000);
  //     }

  function obterdados(idSensor) {
    fetch(`/medidas/temp  o-real/${idSensor}`)
      .then(response => {

        if (response.ok) {
          response.json().then(response => {

            console.log(`Dados recebidos: ${JSON.stringify(response)}`);
            console.log(response[0].temperatura)
            console.log(response[0].umidade)
            temp.innerHTML = response[0].temperatura + "°C";
            var dados = {
              temperatura: response[0].temperatura,
              umidade: response[0].umidade
            }


            alertar(response[0].temperatura, response[0].umidade, idSensor);

          });
        } else {

          console.error('Nenhum dado encontrado ou erro na API');
        }
      })
      .catch(function (error) {
        console.error(`Erro na obtenção dos dados do aquario p/ gráfico: ${error.message}`);
      });

  }

  function alertar(temperatura, umidade, idSensor) {
    var limitesTemp = {
      ideal: 24,
      alerta: 25,
      emergencia: 26,
      critico: 27,
    };
    var limitesUmi = {
      ideal: 75,
      alerta: 78,
      emergencia: 79,
      critico: 80,
    }

    //var classe_temperatura = 'cor-alerta';

    if (temperatura >= limitesTemp.critico) {
      svg.style.fill = "red"
      console.log("caiu no 1")
    }
    else if (temperatura >= limitesTemp.emergencia) {
      svg.style.fill = "orange"
      console.log("caiu no 2")
    }
    else if (temperatura >= limitesTemp.alerta) {
      svg.style.fill = "yellow"
      console.log("caiu no 3")
    }
    else if (temperatura >= limitesTemp.ideal) {
      svg.style.fill = "green"
      console.log("caiu no 4")
    }


    //var card;

    if (idSensor == 1) {
      temp.innerHTML = temperatura + "°C";
      console.log("AQUI")
      // card = card_1
    } else if (idSensor == 2) {
      temp2.innerHTML = temperatura + "°C";
      // card = card_2
    } else if (idSensor == 3) {
      temp3.innerHTML = temperatura + "°C";
      //card = card_3
    } else if (idSensor == 4) {
      temp4.innerHTML = temperatura + "°C";
      // card = card_4
    }

    // alterando
    // card.className = classe_temperatura;

  }
</script>

<script>


  p_usuario.innerHTML = "Olá " + sessionStorage.NOME_USUARIO;

  var proximaAtualizacao;
  var proximaAtualizacao2;

  window.onload = obterDadosGrafico(1);
  window.onload = obterDadosGrafico(2);
  window.onload = obterDadosGrafico(3);
  window.onload = obterDadosGrafico(4);



  //verificar_autenticacao();

  function alterarTitulo(idSensor) {
    // var tituloAquario = document.getElementById("tituloAquario")
    // tituloAquario.innerHTML = "Últimas medidas de Temperatura e Umidade do <span style='color: #e6005a'>Aquário " + idSensor + "</span>"
  }

  // O gráfico é construído com três funções:
  // 1. obterDadosGrafico -> Traz dados do Banco de Dados para montar o gráfico da primeira vez
  // 2. plotarGrafico -> Monta o gráfico com os dados trazidos e exibe em tela
  // 3. atualizarGrafico -> Atualiza o gráfico, trazendo novamente dados do Banco

  // Esta função *obterDadosGrafico* busca os últimos dados inseridos em tabela de medidas.
  // para, quando carregar o gráfico da primeira vez, já trazer com vários dados.
  // A função *obterDadosGrafico* também invoca a função *plotarGrafico*

  //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
  //     Para ajustar o "select", ajuste o comando sql em src/models
  function obterDadosGrafico(idSensor) {
    // alterarTitulo(idSensor)

    if (proximaAtualizacao != undefined) {
      clearTimeout(proximaAtualizacao);
    }
    if(proximaAtualizacao2 != undefined){
      clearTimeout(proximaAtualizacao2);
    }

    fetch(`/medidas/ultimas/${idSensor}`, { cache: 'no-store' }).then(function (response) {
      if (response.ok) {
        response.json().then(function (response) {
          console.log(`Dados recebidos: ${JSON.stringify(response)}`);
          console.log("SENSOR ID: " + idSensor)
          response.reverse();

          if (idSensor == 1) {
            plotarGrafico(response, idSensor);
          } else if (idSensor == 2) {
            plotarGrafico2(response, idSensor);
          } else if (idSensor == 3) {
            plotarGrafico3(response, idSensor);
          } else {
            plotarGrafico4(response, idSensor);
          }



        });
      } else {
        console.error('Nenhum dado encontrado ou erro na API');
      }
    })
      .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
      });




  }

  // Esta função *plotarGrafico* usa os dados capturados na função anterior para criar o gráfico
  // Configura o gráfico (cores, tipo, etc), materializa-o na página e, 
  // A função *plotarGrafico* também invoca a função *atualizarGrafico*
  function plotarGrafico(response, idSensor) {

    console.log('iniciando plotagem do gráfico...');

    // Criando estrutura para plotar gráfico - labels
    var labels = [];

    // Criando estrutura para plotar gráfico - dados
    var dados = {
      labels: labels,
      datasets: [
        {
          label: 'Temperatura',
          data: [],
          fill: false,
          borderColor: 'rgb(199, 52, 52)',
          tension: 0.1
        }]
    };
    var dados2 = {
      labels: labels,
      datasets: [{
        label: 'Umidade',
        data: [],
        fill: false,
        borderColor: 'rgb(75, 192, 192)',
        tension: 0.1
      },
      ]
    };

    console.log('----------------------------------------------')
    console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
    console.log(response)

    // Inserindo valores recebidos em estrutura para plotar o gráfico
    for (i = 0; i < response.length; i++) {
      console.log("Registro ", response[i])
      var registro = response[i];
      labels.push(registro.momento_grafico);
      dados.datasets[0].data.push(registro.temperatura);
      dados2.datasets[0].data.push(registro.umidade);
    }

    console.log('----------------------------------------------')
    console.log('O gráfico será plotado com os respectivos valores:')
    console.log('Labels:')
    console.log(labels)
    console.log('Dados:')
    console.log(dados.datasets)
    console.log('Dados22:')
    console.log(dados2.datasets)
    console.log('----------------------------------------------')

    // Criando estrutura para plotar gráfico - config
    const config = {
      type: 'line',
      data: dados,
    };
    const config2 = {
      type: 'bar',
      data: dados2,
    };

    // Adicionando gráfico criado em div na tela
    var myChart = new Chart(
      document.getElementById('myChart'),
      config
    );
    var myChart2 = new Chart(
      document.getElementById('myChart2'),
      config2
    );











    setTimeout(() => atualizarGrafico(idSensor, dados, myChart), 5000);

  }

  function plotarGrafico2(response, idSensor) {

    console.log('iniciando plotagem do gráfico...');

    // Criando estrutura para plotar gráfico - labels
    var labels = [];

    // Criando estrutura para plotar gráfico - dados
    var dados = {
      labels: labels,
      datasets: [
        {
          label: 'Temperatura',
          data: [],
          fill: false,
          borderColor: 'rgb(199, 52, 52)',
          tension: 0.1
        }]
    };
    var dados2 = {
      labels: labels,
      datasets: [{
        label: 'Umidade',
        data: [],
        fill: false,
        borderColor: 'rgb(75, 192, 192)',
        tension: 0.1
      },
      ]
    };

    console.log('----------------------------------------------')
    console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
    console.log(response)

    // Inserindo valores recebidos em estrutura para plotar o gráfico
    for (i = 0; i < response.length; i++) {
      console.log("Registro ", registro[i])
      var registro = response[i];
      labels.push(registro.data_horario);
      dados.datasets[0].data.push(registro.umidade);
      dados2.datasets[0].data.push(registro.temperatura);
    }

    console.log('----------------------------------------------')
    console.log('O gráfico será plotado com os respectivos valores:')
    console.log('Labels:')
    console.log(labels)
    console.log('Dados:')
    console.log(dados.datasets)
    console.log(dados2.datasets)
    console.log('----------------------------------------------')

    // Criando estrutura para plotar gráfico - config
    const config = {
      type: 'line',
      data: dados2,
    };
    const config2 = {
      type: 'bar',
      data: dados,
    };

    // Adicionando gráfico criado em div na tela
    var myChart3 = new Chart(
      document.getElementById('myChart3'),
      config
    );
    var myChart4 = new Chart(
      document.getElementById('myChart4'),
      config2
    );











    // setTimeout(() => atualizarGrafico(idSensor, dados,dados2, myChart3), 2000);
    // setTimeout(() => atualizarGrafico(idSensor, dados,dados2, myChart4), 2000);

  }

  function plotarGrafico3(response, idSensor) {

    console.log('iniciando plotagem do gráfico...');

    // Criando estrutura para plotar gráfico - labels
    var labels = [];

    // Criando estrutura para plotar gráfico - dados
    var dados = {
      labels: labels,
      datasets: [
        {
          label: 'Temperatura',
          data: [],
          fill: false,
          borderColor: 'rgb(199, 52, 52)',
          tension: 0.1
        }]
    };
    var dados2 = {
      labels: labels,
      datasets: [{
        label: 'Umidade',
        data: [],
        fill: false,
        borderColor: 'rgb(75, 192, 192)',
        tension: 0.1
      },
      ]
    };

    console.log('----------------------------------------------')
    console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
    console.log(response)

    // Inserindo valores recebidos em estrutura para plotar o gráfico
    for (i = 0; i < response.length; i++) {
      console.log("Registro ", registro[i])
      var registro = response[i];
      labels.push(registro.data_horario);
      dados.datasets[0].data.push(registro.umidade);
      dados2.datasets[0].data.push(registro.temperatura);
    }

    console.log('----------------------------------------------')
    console.log('O gráfico será plotado com os respectivos valores:')
    console.log('Labels:')
    console.log(labels)
    console.log('Dados:')
    console.log(dados.datasets)
    console.log(dados2.datasets)
    console.log('----------------------------------------------')

    // Criando estrutura para plotar gráfico - config
    const config = {
      type: 'line',
      data: dados2,
    };
    const config2 = {
      type: 'bar',
      data: dados,
    };

    // Adicionando gráfico criado em div na tela
    var myChart5 = new Chart(
      document.getElementById('myChart5'),
      config
    );
    var myChart6 = new Chart(
      document.getElementById('myChart6'),
      config2
    );











    // setTimeout(() => atualizarGrafico(idSensor, dados,dados2, myChart5), 2000);
    // setTimeout(() => atualizarGrafico(idSensor, dados,dados2, myChart6), 2000);

  }

  function plotarGrafico4(response, idSensor) {

    console.log('iniciando plotagem do gráfico...');

    // Criando estrutura para plotar gráfico - labels
    var labels = [];

    // Criando estrutura para plotar gráfico - dados
    var dados = {
      labels: labels,
      datasets: [
        {
          label: 'Temperatura',
          data: [],
          fill: false,
          borderColor: 'rgb(199, 52, 52)',
          tension: 0.1
        }]
    };
    var dados2 = {
      labels: labels,
      datasets: [{
        label: 'Umidade',
        data: [],
        fill: false,
        borderColor: 'rgb(75, 192, 192)',
        tension: 0.1
      },
      ]
    };

    console.log('----------------------------------------------')
    console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
    console.log(response)

    // Inserindo valores recebidos em estrutura para plotar o gráfico
    for (i = 0; i < response.length; i++) {
      console.log("Registro ", registro[i])
      var registro = response[i];
      labels.push(registro.data_horario);
      dados.datasets[0].data.push(registro.umidade);
      dados2.datasets[0].data.push(registro.temperatura);
    }

    console.log('----------------------------------------------')
    console.log('O gráfico será plotado com os respectivos valores:')
    console.log('Labels:')
    console.log(labels)
    console.log('Dados:')
    console.log(dados.datasets)
    console.log(dados2.datasets)
    console.log('----------------------------------------------')

    // Criando estrutura para plotar gráfico - config
    const config = {
      type: 'line',
      data: dados2,
    };
    const config2 = {
      type: 'bar',
      data: dados,
    };

    // Adicionando gráfico criado em div na tela
    var myChart7 = new Chart(
      document.getElementById('myChart7'),
      config
    );
    var myChart8 = new Chart(
      document.getElementById('myChart8'),
      config2
    );











    // setTimeout(() => atualizarGrafico(idSensor, dados,dados2 ,myChart7), 2000);
    // setTimeout(() => atualizarGrafico(idSensor, dados,dados2, myChart8), 2000);

  }


  // Esta função *atualizarGrafico* atualiza o gráfico que foi renderizado na página,
  // buscando a última medida inserida em tabela contendo as capturas, 

  //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
  //     Para ajustar o "select", ajuste o comando sql em src/models
  function atualizarGrafico(idSensor, dados, myChart) {

    fetch(`/medidas/tempo-real/${idSensor}`, { cache: 'no-store' }).then(function (response) {
      if (response.ok) {
        response.json().then(function (novoRegistro) {

          console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
          console.log(`Dados atuais do gráfico: `);
          console.log(dados);

          // document.getElementById("avisoCaptura").innerHTML = ""
          console.log("NOVO REGISTRO ", novoRegistro[0].data_horario)
          console.log("AAAA ", dados.labels[dados.labels.length - 1])
          console.log("DADOS 1", dados)

          if (novoRegistro[0].data_horario == dados.labels[dados.labels.length - 1]) {
            console.log("IF")
            console.log("---------------------------------------------------------------")
            console.log("Como não há dados novos para captura, o gráfico não atualizará.")
            // document.getElementById("avisoCaptura").innerHTML = "<i class='fa-solid fa-triangle-exclamation'></i> Foi trazido o dado mais atual capturado pelo sensor. <br> Como não há dados novos a exibir, o gráfico não atualizará."
            console.log("Horário do novo dado capturado:")
            console.log(novoRegistro[0].data_horario)
            console.log("Horário do último dado capturado:")
            console.log(dados.labels[dados.labels.length - 1])
            console.log("---------------------------------------------------------------")
          } else {
            console.log("ELSE")
            console.log("---------------------------------------------------------------")
            console.log("Como há dados novos para captura, o gráfico será atualizado.")
            // tirando e colocando valores no gráfico
            dados.labels.shift(); // apagar o primeiro
            dados.labels.push(novoRegistro[0].data_horario); // incluir um novo momento

            dados.datasets[0].data.shift();  // apagar o primeiro de umidade
            dados.datasets[0].data.push(novoRegistro[0].temperatura); // incluir uma nova medida de umidade
            myChart.update();
          }

          // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
          proximaAtualizacao = setTimeout(() => atualizarGrafico(idSensor, dados, myChart), 2000);
        });
      } else {
        console.error('Nenhum dado encontrado ou erro na API');
        // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
        proximaAtualizacao = setTimeout(() => atualizarGrafico(idSensor, dados, myChart), 2000);
      }
    })
      .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
      });

  }



 



</script>





<script src="../js/scriptmodais.js"></script>